<html>
{% load staticfiles %}
<head>
    <link rel="stylesheet" href="{% static 'users/jquery-ui.css' %}"/>
    <script src="{% static 'users/jquery-1.9.1.js' %}"></script>
    <script src="{% static 'users/jquery-ui.js' %}"></script>
    <script src="{% static 'users/common.js' %}"></script>
    <script src="{% static 'tasks/tasks.js' %}"></script>
    <script src="{% static 'tasks/tasksButtons.js' %}"></script>
    <link rel="stylesheet" href="{% static 'users/UsersStyle.css' %}"/>
    <link rel="stylesheet" href="{% static 'tasks/TasksStyle.css' %}"/>
    <script>
        /* Here i can code everything then move it outside... */
        var loged = false;
        $(function () {
            $("div#hp").hide();
            $("div#credits").hide();
            $("div#avatar").hide();
            $("div#userOptions").hide();
            initDialogs();
            User.login();
        });

        var User = {
            login: function () {
                $.ajax({
                    type: "POST",
                    url: "login",
                    data: {csrfmiddlewaretoken: '{{csrf_token}}', username: '', password: '' },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
                }).done(function (msg) {
                            if (msg != "False") {
                                var user = $.parseJSON(msg);
                                loged = true;
                                $("div#userOptions").append("<a id=logoutButton href=#>Logout</a>");
                                User.logout();
                                Tasks.load();
                                $("div#hp").fadeIn();
                                $("div#hp span").text(user[0].fields.hp);
                                $("div#credits").fadeIn();
                                $("div#credits span").text(user[0].fields.credits);
                                $("div#avatar").fadeIn();
                            }
                            else {
                                $.ajax({
                                    type: "GET",
                                    url: "accounts/login/",
                                    data: {csrfmiddlewaretoken: '{{csrf_token}}'},
                                    error: function (request, status, error) {
                                        alerta(request.responseText);
                                    }
                                }).done(function (msg) {
                                            $("div#header").html("<h1>Ready to Game?</h1>");
                                            $("div#content").html(msg);
                                        })

                            }
                        })
            },
            logout: function () {
                $("a#logoutButton").button().click(function (event) {
                    event.preventDefault();
                    $.ajax({
                        type: "GET",
                        url: "logout"
                    }).done(function (msg) {
                                $(this).hide();
                                location.reload();
                            })
                });
            }
        }

        var Task = {
            view: function () {

            },
            update: function () {

            }
        }
    </script>
</head>
<body>
<div id=header>
    <div id=avatar><img src="{% static 'users/images/avatar.png' %}" /></div>
    <div id=hp><span>0</span><img src="{% static 'tasks/images/blood.png' %}" /></div>
    <div id=credits><span>0</span><img src="{% static 'tasks/images/money.png' %}" /></div>
    <div id=userOptions></div>
</div>
<div id=content></div>
<div id=footer>
    <img class=button  id=completed src="{% static 'tasks/images/completed.png' %}" />
    <img class=button  id=reward src="{% static 'tasks/images/reward.png' %}" />
    <img class=button  id=trash src="{% static 'tasks/images/fire.png' %}" />
</div>

<div id=dialogAddTask title="New Task">
    <p class="validateTips">positive number for good habits, negative number for bad habits.</p>
    <dl class="list_habit ui-sortable" id="list2" style="display: inline-block;">
    <dd class="task" id="44" style="zoom: 0.7">
        <ul>
            <li class="taskText">This is a task u need to do :D</li>
        </ul>
        </dd>
        </dl>
    <form name=formDialogAddTask>
    <fieldset>
        <label for="value">Gain</label>
        <input value=10 type="text" name="value" id="value" class="text ui-widget-content ui-corner-all" />
    </fieldset>
  </form>
</div>

</body>
</html>